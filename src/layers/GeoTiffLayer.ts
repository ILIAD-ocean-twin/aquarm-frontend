import TileLayer from 'ol/layer/WebGLTile.js';
import GeoTIFF from 'ol/source/GeoTIFF.js';
import Layer from "ol/layer/Layer";
import LayerRenderer from "ol/renderer/Layer";
import { IDataLayer } from './IDataLayer';

export class GeoTiffLayer implements IDataLayer {
    name: string;
    description: string;
    visible: boolean = false;
    layer: Layer<GeoTIFF, LayerRenderer<any>>;
    updates = false;

    constructor(name: string, description: string, rasterUrl: string, normalize: boolean) {
        this.name = name;
        this.description = description;
        const source = new GeoTIFF({ sources: [{ url: rasterUrl, nodata: 0 }], normalize });
        //@ts-ignore
        this.layer = new TileLayer({
            visible: false,
            opacity: 0.75,
            source: source,
            style: {
                color: [
                    'interpolate', ['linear'], ['band', 1],
                    0.0, [0, 0, 0, 0],
                    0.03225806451612903, [70.63959, 12.83772, 95.807325, 1.0],
                    0.06451612903225806, [71.993385, 24.213525, 106.419405, 1.0],
                    0.0967741935483871, [72.13542000000001, 34.659600000000005, 115.623885, 1.0],
                    0.12903225806451613, [70.89305999999999, 45.993585, 124.10773499999999, 1.0],
                    0.16129032258064516, [68.67354, 55.798590000000004, 129.94213499999998, 1.0],
                    0.1935483870967742, [65.61711, 65.31315000000001, 134.273565, 1.0],
                    0.22580645161290322, [61.993815, 74.48346000000001, 137.32158, 1.0],
                    0.25806451612903225, [57.595065000000005, 84.355275, 139.56507, 1.0],
                    0.2903225806451613, [53.678264999999996, 92.75038500000001, 140.81252999999998, 1.0],
                    0.3225806451612903, [49.9443, 100.835415, 141.59538, 1.0],
                    0.3548387096774194, [46.47528, 108.67692, 142.0656, 1.0],
                    0.3870967741935484, [42.87213, 117.29694, 142.31090999999998, 1.0],
                    0.41935483870967744, [39.84885, 124.85412, 142.27367999999998, 1.0],
                    0.45161290322580644, [36.913545, 132.368715, 141.92586, 1.0],
                    0.4838709677419355, [34.104465, 139.876425, 141.152955, 1.0],
                    0.5161290322580645, [31.483065, 148.330185, 139.59847499999998, 1.0],
                    0.5483870967741935, [30.452865, 155.840955, 137.44040999999999, 1.0],
                    0.5806451612903226, [31.8189, 163.317555, 134.40233999999998, 1.0],
                    0.6129032258064516, [36.542265, 170.71204500000002, 130.359825, 1.0],
                    0.6451612903225806, [46.066515, 178.85751, 124.48819499999999, 1.0],
                    0.6774193548387096, [57.731235, 185.86643999999998, 118.011195, 1.0],
                    0.7096774193548387, [71.776635, 192.576765, 110.30076, 1.0],
                    0.7419354838709677, [87.73886999999999, 198.90739499999998, 101.332155, 1.0],
                    0.7741935483870968, [107.58654, 205.47236999999998, 89.73705, 1.0],
                    0.8064516129032258, [126.63682499999999, 210.72588, 78.126135, 1.0],
                    0.8387096774193549, [146.76856500000002, 215.36433000000002, 65.385825, 1.0],
                    0.8709677419354839, [167.69870999999998, 219.355845, 51.78591, 1.0],
                    0.9032258064516129, [191.73042, 223.112505, 36.52314, 1.0],
                    0.9354838709677419, [212.99384999999998, 225.93739499999998, 26.17473, 1.0],
                    0.967741935483871, [233.64171, 228.50320499999998, 25.682835, 1.0],
                    1.0, [253.27824, 231.070035, 36.703680000000006, 1.0],
                ]
            }
        })
    }

    public async setVisible(visible: boolean): Promise<void> {
        this.visible = visible;
        this.layer.setVisible(visible);
    }

    public getLegend(): HTMLElement {
        return undefined;
    }
}
